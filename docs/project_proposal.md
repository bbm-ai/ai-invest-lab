# ğŸ¤– AI å°ˆæ¥­æŠ•è³‡åœ˜éšŠ - å®Œæ•´å°ˆæ¡ˆä¼åŠƒæ›¸ (21 å¤©å„ªåŒ–ç‰ˆ, v2)

## ğŸ“‹ å°ˆæ¡ˆæ¦‚è¿°

### å°ˆæ¡ˆé¡˜æ™¯
å»ºç«‹ä¸€å€‹å®Œå…¨è‡ªä¸»é‹ä½œçš„ AI æŠ•è³‡åœ˜éšŠï¼Œèƒ½å¤  24/7 è‡ªå‹•æ”¶é›†å¸‚å ´æ•¸æ“šã€åˆ†æè¶¨å‹¢ã€åˆ¶å®šç­–ç•¥ï¼Œä¸¦æŒçºŒè‡ªæˆ‘å„ªåŒ–ï¼Œæœ€çµ‚é”åˆ°å°ˆæ¥­æŠ•è³‡åœ˜éšŠçš„æ±ºç­–æ°´å¹³ã€‚

### æ ¸å¿ƒç›®æ¨™ (Optimized)
* **æœ€ä½æˆæœ¬é‹è¡Œ**ï¼š**å…è²»å±¤ç´šè³‡æºå„ªå…ˆ** (Google Cloud Free Tier, Groq/Gemini Free Tier)ï¼Œé‹è¡Œæˆæœ¬æ§åˆ¶åœ¨ $0â€“2/æœˆã€‚
* **è‡ªä¸»é‹ä½œ**ï¼šç„¡éœ€äººå·¥å¹²é ï¼Œè‡ªå‹•å¾ªç’°åŸ·è¡Œã€‚
* **æ‰‹æ©Ÿå‹å¥½**ï¼š**Web å„€è¡¨æ¿ (Streamlit)** éŸ¿æ‡‰å¼è¨­è¨ˆï¼Œé€é **Telegram/Email** æ¨é€é—œéµå ±å‘Šèˆ‡å‘Šè­¦ã€‚
* **ç³»çµ±å¥å£¯æ€§**ï¼š**API æ•…éšœåˆ‡æ› (Failover)** æ©Ÿåˆ¶ï¼Œç¢ºä¿æ±ºç­–ä¸ä¸­æ–·ã€‚
* **æ•¸æ“šé©…å‹•**ï¼šæ‰€æœ‰æ±ºç­–å¯è¿½æº¯ã€å¯å›æ¸¬ï¼Œä¿ç•™å®Œæ•´æ—¥èªŒèˆ‡ç‰ˆæœ¬ã€‚

---

## ğŸ¯ å°ˆæ¡ˆéšæ®µè¦åŠƒ

| éšæ®µ (Phase) | æ—¥æœŸ | é‡é»å·¥ä½œ | é‡Œç¨‹ç¢‘ (Milestone) |
| :--- | :--- | :--- | :--- |
| **Phase 1** | **Day 1â€“7** | **MVP åŸºç¤æ¶æ§‹**ï¼šVMã€Gitã€ç’°å¢ƒã€æ•¸æ“šåº«ã€æ•¸æ“šæ”¶é›†è…³æœ¬ã€Agent æ¡†æ¶ã€‚ | **Milestone 1**ï¼šå–®æ¬¡é‹è¡ŒæˆåŠŸï¼Œæ•¸æ“šæ­£ç¢ºå­˜å„²ï¼ŒAgent æ¡†æ¶æ­å»ºå®Œæˆã€‚ |
| **Phase 2** | **Day 8â€“14** | **AI æ™ºèƒ½å¢å¼·**ï¼šGroq/Gemini/Claude APIã€æƒ…æ„Ÿåˆ†æã€æŠ€è¡“åˆ†æã€ç­–ç•¥ç”Ÿæˆã€**API æ™ºèƒ½è·¯ç”±**ã€‚ | **Milestone 2**ï¼šå¤šæ¨¡æ…‹åˆ†æç­–ç•¥è¼¸å‡ºï¼Œå«æˆæœ¬æ—¥èªŒã€‚ |
| **Phase 3** | **Day 15â€“21** | **éƒ¨ç½²èˆ‡å„ªåŒ–**ï¼šSystemd + Cronã€Failoverã€å‚™ä»½/å‘Šè­¦ã€Streamlitã€å›æ¸¬æ¡†æ¶ã€‚ | **Milestone 3**ï¼š24/7 è‡ªå‹•é‹è¡Œã€å‘Šè­¦/å‚™ä»½å®Œæ•´ã€å„€è¡¨æ¿å¯è¦–åŒ–ã€‚ |

---

## ğŸš€ 21 å¤©æ™‚é–“è¡¨ (æ‘˜è¦)
> å®Œæ•´ Task è©³è¦‹ `task_cards.md`

| Day | éšæ®µ | ä»»å‹™å¡ | æ ¸å¿ƒå·¥ä½œå…§å®¹ | é©—æ”¶/æˆæœ |
| :--- | :--- | :--- | :--- | :--- |
| 1â€“7 | 1 | T01â€“T07 | VM/Repo/SQLite/BaseAgent/Collector/Master/åˆé©—æ”¶ | **Milestone 1** |
| 8â€“14 | 2 | T08â€“T14 | API Clients/APIRouter/Analyst/Strategist/æˆæœ¬æ§åˆ¶/äºŒæ¬¡é©—æ”¶ | **Milestone 2** |
| 15â€“21 | 3 | T15â€“T21 | Systemd+Cron/Failover/å‚™ä»½å‘Šè­¦/å›æ¸¬/UI/çµæ¡ˆå ±å‘Š | **Milestone 3** |

---

## ğŸ”§ æŠ€è¡“æ¶æ§‹èˆ‡é—œéµè¨­è¨ˆ

### 1) æ•¸æ“šåº«è¨­è¨ˆ (SQLite, å¯å‡ç´š)
```sql
CREATE TABLE IF NOT EXISTS strategies (
    id INTEGER PRIMARY KEY,
    date DATE NOT NULL,
    symbol TEXT DEFAULT 'SPY',
    recommendation TEXT,  -- BUY / SELL / HOLD
    reasoning TEXT,
    risk_level TEXT,
    position_size REAL,
    confidence REAL,      -- 0â€“1, ç”± LLM è¼¸å‡º
    is_executed BOOLEAN DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 2) èª¿åº¦èˆ‡æ™‚å€
ä½¿ç”¨ `config.yaml` å®šç¾©æŠ•è³‡æ¨™çš„ã€æ™‚å€èˆ‡ Cron è¡¨é”å¼ã€‚ç­–ç•¥åˆ†æé ˆåœ¨ **ç¾è‚¡æ”¶ç›¤å¾Œ (16:00 ET)** åŸ·è¡Œã€‚

```yaml
investment:
  symbols: ["SPY"]

schedule:
  timezone: "America/New_York"  # ä»¥ç¾è‚¡æ™‚é–“é‹è¡Œ
  strategy: "0 17 * * 1-5"       # é€±ä¸€è‡³é€±äº” 17:00 (æ”¶ç›¤å¾Œ 1h)
  data_collection: "0 */4 * * *" # æ¯ 4 å°æ™‚æŠ“åƒ¹
  backup: "0 2 * * *"            # æ¯æ—¥ 02:00 å‚™ä»½
```

> **è½åœ°å‚™è¨»**ï¼šVM ç³»çµ±æ™‚å€å¯ç¶­æŒåœ¨ Asia/Taipeiï¼ŒCron Job ä»¥ `TZ=America/New_York` è¦†å¯«ï¼›Systemd æœå‹™è£¡ä¹Ÿå¯æ³¨å…¥ `Environment=TZ=America/New_York`ï¼Œç¢ºä¿æ™‚é–“ä¸€è‡´ã€‚

### 3) API æ™ºèƒ½è·¯ç”± (æˆæœ¬å„ªå…ˆ + Failover)

- **ä»»å‹™åˆ†æµ**ï¼š
  - `news_summary` â†’ **Groq (Llama3-8B)**
  - `technical_analysis` â†’ **Gemini Flash**
  - `high_confidence_decision` (ä½ä¿¡å¿ƒ/é«˜æ³¢å‹•) â†’ **Claude**
- **æˆæœ¬æ§åˆ¶**ï¼šè¨˜éŒ„æ¯æ¬¡ API token/æˆæœ¬ï¼Œç´å…¥ KPIï¼›åƒ…åœ¨ `should_use_claude()` è¿”å› `True` æ™‚èª¿ç”¨ Claudeã€‚
- **æ•…éšœåˆ‡æ›**ï¼šä¸»è¦ä¾›æ‡‰å•†é€¾æ™‚/éŒ¯èª¤ â†’ è‡ªå‹•åˆ‡æ›æ¬¡å„ªï¼ˆä¾‹ï¼šGroq â†’ Gemini Flashï¼‰ã€‚

**åƒè€ƒéª¨æ¶**ï¼š
```python
class APIRouter:
    def __init__(self, clients):
        self.c = clients  # {"groq": g, "gemini": ge, "gemini_flash": gf, "claude": c}

    def call(self, task: str, payload: dict):
        plan = {
            "news_summary": ["groq", "gemini_flash"],
            "technical_analysis": ["gemini_flash", "groq"],
            "high_confidence_decision": ["claude", "gemini"]
        }.get(task, ["groq", "gemini_flash"])  # é è¨­

        last_err = None
        for key in plan:
            try:
                return self.c[key].run(payload)
            except Exception as e:
                last_err = e
                continue
        raise RuntimeError(f"APIRouter failover exhausted: {last_err}")

    def should_use_claude(self, context) -> bool:
        # ä½ä¿¡å¿ƒã€VIX é«˜æ–¼é–¾å€¼ã€æˆ–å¤šç­–ç•¥åˆ†æ­§æ˜é¡¯
        return (
            context.get("confidence", 1.0) < 0.6
            or context.get("vix", 0) >= 25
            or context.get("disagreement_score", 0) >= 0.4
        )
```

### 4) å¥åº·æª¢æŸ¥ã€å‚™ä»½èˆ‡å‘Šè­¦
- **å¥åº·æª¢æŸ¥**ï¼šæš´éœ² `/health` (return `{status: 'ok', ts}`)ï¼Œæ¯æ—¥ `curl` æª¢æŸ¥ï¼Œå¤±æ•—å³å‘Šè­¦ã€‚
- **å‚™ä»½**ï¼š`cron + rclone` â†’ Google Drive/GCSï¼›æ¯æ—¥å…¨é‡ SQLite å‚™ä»½ + æ¯é€±å£“ç¸®å­˜æª”ã€‚
- **å‘Šè­¦**ï¼šTelegram Bot çµ±ä¸€æ ¼å¼ï¼š`[UTC-5 17:00][Master][OK/ERROR][code][hint]`ã€‚

### 5) å ±å‘Šèˆ‡ç‰ˆæœ¬æ§ç®¡
- è‡ªå‹•è¼¸å‡ºï¼š
  - `/reports/backtest_report.md`
  - `/docs/system_architecture.md`
  - `/logs/api_usage_summary.csv`
- ä»¥ `jinja2` æ¨¡æ¿ç”Ÿæˆ Markdown å ±å‘Šï¼ŒGit ç‰ˆæœ¬æ¨™è¨˜ï¼ˆtag: `v0.1-m1`, `v0.2-m2` ...ï¼‰ã€‚

---

## ğŸ éšæ®µæ€§é‡Œç¨‹ç¢‘ (é©—æ”¶é‡é»)

### Milestone 1 (Day 7)
- VM/Repo/ç’°å¢ƒå®Œæˆï¼›Master å®Œæˆä¸€æ¬¡ç«¯åˆ°ç«¯æ”¶é›†ï¼›SPY æ­·å²åƒ¹ & æ–°èå…¥åº«ï¼›`BaseAgent` ä»‹é¢ç©©å®šã€‚

### Milestone 2 (Day 14)
- APIRouter ä»»å‹™åˆ†æµèˆ‡æˆæœ¬æ—¥èªŒï¼›Analyst ç”¢å‡ºæƒ…ç·’ & æŠ€è¡“æ‘˜è¦ï¼›Strategist è¼¸å‡ºå«å€‰ä½èˆ‡ä¿¡å¿ƒï¼›`should_use_claude` ç”Ÿæ•ˆã€‚

### Milestone 3 (Day 21)
- Systemd + Cron 24/7ï¼›**America/New_York** å®šæ™‚æ­£ç¢ºï¼›Failover æ¸¬è©¦é€šéï¼›å‚™ä»½/å‘Šè­¦æ­£å¸¸ï¼›Streamlit é¡¯ç¤ºå³æ™‚æ•¸æ“šèˆ‡ç­–ç•¥ã€‚
