# ğŸ§© Strategy Detail â€” UI å…ƒä»¶è¦æ ¼æ›¸ï¼ˆv1ï¼Œç„¡ç¨‹å¼ç¢¼ï¼‰

> æœ¬æ–‡ä»¶å®šç¾©ã€Œç­–ç•¥è©³æƒ…é ã€çš„**å…ƒä»¶æ¸…å–®ã€è³‡æ–™å¥‘ç´„ï¼ˆData Contractsï¼‰ã€äº’å‹•è¡Œç‚ºã€ç‹€æ…‹ç®¡ç†ã€æ•ˆèƒ½èˆ‡å¯ç”¨æ€§è¦ç¯„**ï¼Œç”¨æ–¼æŒ‡å°å‰ç«¯ï¼ˆStreamlit/å‰ç«¯æ¡†æ¶ï¼‰èˆ‡å¾Œç«¯è³‡æ–™æä¾›è€…çš„å”ä½œã€‚
> **ç¯„åœ**ï¼šä¸åŒ…å«ä»»ä½•å¯¦ä½œç¨‹å¼ç¢¼ï¼›æ­é… `dashboard_ia.md`ã€`system_architecture.md` ä½¿ç”¨ã€‚

---

## 0) é é¢ç›®æ¨™èˆ‡ä½¿ç”¨æƒ…å¢ƒ

- å¿«é€Ÿç†è§£ã€ŒæŸæ—¥/æŸæ¨™çš„ã€çš„æŠ•è³‡å»ºè­°ï¼ˆRecï¼‰ã€å€‰ä½ï¼ˆPosition Sizeï¼‰ã€ä¿¡å¿ƒï¼ˆConfidenceï¼‰ï¼Œèˆ‡å…¶ä¾æ“šï¼ˆæƒ…ç·’æ‘˜è¦/æŠ€è¡“è¨Šè™Ÿ/å¼•ç”¨æ–°èï¼‰ã€‚
- å¯è¿½æº¯ç”¢ç”Ÿç­–ç•¥æ™‚çš„ API æ±ºç­–è·¯å¾‘ï¼ˆAPIRouterï¼‰èˆ‡æˆæœ¬ã€‚
- æ”¯æ´å¯©æŸ¥ï¼šå°æ‡‰åˆ°è³‡æ–™åº«ç´€éŒ„èˆ‡ç‰ˆæœ¬ï¼ˆPrompt/ç­–ç•¥ç‰ˆæœ¬æ¨™è¨˜ï¼‰ã€‚

KPIï¼šç”¨æˆ¶åœ¨ 10 ç§’å…§è®€æ‡‚ç­–ç•¥çµè«–ï¼›äº’å‹•å¾Œ 3 ç§’å…§å®Œæˆä¸»è¦è¦–åœ–æ¸²æŸ“ã€‚

---

## 1) è³‡æ–™å¥‘ç´„ï¼ˆData Contractsï¼‰

### 1.1 `StrategyRecord`
| æ¬„ä½ | å‹åˆ¥ | èªªæ˜ | ä¾†æº |
|---|---|---|---|
| `id` | str/int | ç­–ç•¥ä¸»éµ | `strategies.id` |
| `date` | ISODate | ç”Ÿæˆæ—¥æœŸï¼ˆä»¥ NY æ™‚å€é¡¯ç¤ºï¼‰ | `strategies.date` |
| `symbol` | string | ä¾‹å¦‚ `SPY` | `strategies.symbol` |
| `recommendation` | enum | `BUY` / `SELL` / `HOLD` | `strategies.recommendation` |
| `position_size` | number | å€‰ä½æ¯”ä¾‹ 0~1 | `strategies.position_size` |
| `confidence` | number | ä¿¡å¿ƒ 0~1 | `strategies.confidence` |
| `reasoning` | string | æ–‡å­—èªªæ˜ï¼ˆå¯å«åˆ†é»ï¼‰ | `strategies.reasoning` |
| `version` | string | ç­–ç•¥ç‰ˆæœ¬ï¼ˆå¯é¸ï¼‰ | ç‰ˆæœ¬ç®¡ç† |
| `created_at` | ISODate | å»ºç«‹æ™‚é–“ | `strategies.created_at` |

### 1.2 `TechSnapshot`
| æ¬„ä½ | å‹åˆ¥ | èªªæ˜ | ä¾†æº |
|---|---|---|---|
| `rsi` | number | 0~100 | `tech_signals.rsi` |
| `macd` | number | MACD å€¼ | `tech_signals.macd` |
| `signal` | number | MACD Signal | è¡ç”Ÿ/DB |
| `trend` | enum | `UP`/`DOWN`/`NEUTRAL` | `tech_signals.trend` |
| `window` | string | è¨ˆç®—çª—å£å¦‚ `14D` | ç®—æ³•é…ç½® |

### 1.3 `SentimentSeriesItem`
| æ¬„ä½ | å‹åˆ¥ | èªªæ˜ |
|---|---|---|
| `ts` | ISODate | ç™¼å¸ƒæˆ–è™•ç†æ™‚é–“ |
| `score` | number | -1 ~ +1 |
| `summary` | string | 50~200 å­—æ‘˜è¦ |

### 1.4 `NewsReference`
| æ¬„ä½ | å‹åˆ¥ | èªªæ˜ |
|---|---|---|
| `title` | string | æ–°èæ¨™é¡Œ |
| `source` | string | åª’é«”ä¾†æº |
| `url` | string (URL) | åŸæ–‡é€£çµ |
| `published_at` | ISODate | ç™¼å¸ƒæ™‚é–“ |
| `url_hash` | string | å»é‡éµ |

### 1.5 `RouterTrace`
| æ¬„ä½ | å‹åˆ¥ | èªªæ˜ |
|---|---|---|
| `task_type` | enum | `news_summary` / `technical_analysis` / `high_confidence_decision` |
| `vendor` | enum | `groq` / `gemini` / `gemini_flash` / `claude` |
| `fallback_used` | boolean | æ˜¯å¦å•Ÿç”¨ Failover |
| `latency_ms` | number | è«‹æ±‚å»¶é² |
| `tokens` | number | token æ•¸ |
| `cost_usd` | number | æˆæœ¬ï¼ˆé ä¼°/å¯¦æ•¸ï¼‰ |
| `ts` | ISODate | æ™‚é–“æˆ³ |

---

## 2) å…ƒä»¶æ¸…å–®ï¼ˆComponentsï¼‰

### 2.1 `StrategyHeader`
- **ç”¨é€”**ï¼šå‘ˆç¾ç­–ç•¥é—œéµçµè«–ã€‚
- **æ¬„ä½/Props**ï¼š`date`, `symbol`, `recommendation`, `position_size`, `confidence`, `version`ã€‚
- **æ ¼å¼**ï¼š
  - `recommendation`ï¼šè‰²å½©æ¨™ç¤ºï¼ˆBUY=ç¶ ï¼ŒHOLD=ç°ï¼ŒSELL=ç´…ï¼‰ã€‚
  - `position_size`ï¼šç™¾åˆ†æ¯”ï¼ˆ0â€“100%ï¼‰èˆ‡æ–‡å­—è§£é‡‹ï¼ˆå¦‚ `ä¸­ç­‰å€‰ä½`ï¼‰ã€‚
  - `confidence`ï¼šé€²åº¦æ¢æˆ–å„€è¡¨ï¼ˆ0â€“1ï¼‰ã€‚
- **ç‹€æ…‹**ï¼šLoading / Ready / Errorï¼ˆé¡¯ç¤ºéŒ¯èª¤æ¢èˆ‡é‡æ•´ï¼‰ã€‚
- **A11y**ï¼šARIA labelï¼›é¡è‰²èˆ‡æ–‡å­—é›™é‡è¡¨è¿°ã€‚

### 2.2 `ReasoningCard`
- **ç”¨é€”**ï¼šå±•ç¤ºç­–ç•¥ç†ç”±ï¼ˆå¯åˆ†é»ï¼‰ã€‚
- **æ¬„ä½**ï¼š`reasoning`ï¼ˆmarkdown æ”¯æ´ï¼‰ã€`generated_ts`ã€`version`ã€‚
- **äº’å‹•**ï¼šå±•é–‹/æ”¶åˆï¼›ã€Œè¤‡è£½åˆ°å‰ªè²¼ç°¿ã€ï¼›åŒ¯å‡º MDã€‚

### 2.3 `PriceWithIndicatorsChart`
- **ç”¨é€”**ï¼šåƒ¹åœ– + RSI/MACD ç–Šåœ–ï¼ˆå–®ä¸€é é¢ç¨ç«‹åœ–ï¼Œä¸æ··åˆè»¸ï¼‰ã€‚
- **è³‡æ–™å¥‘ç´„**ï¼š
  - `price_series`: `{ ts, open, high, low, close, volume }[]`
  - `rsi_series`: `{ ts, rsi }[]`
  - `macd_series`: `{ ts, macd, signal }[]`
- **äº’å‹•**ï¼šæ»‘é¼  hover å·¥å…·æç¤ºã€æ—¥æœŸç¯„åœé¸æ“‡ï¼ˆ7/30/90 æ—¥ï¼‰ã€é‡ç½®è¦–çª—ã€‚
- **æ•ˆèƒ½**ï¼šP95 < 800msï¼ˆ1 è¬é»å…§ï¼‰ï¼›è³‡æ–™é è¼‰æˆ–æŠ½æ¨£ï¼ˆdown-samplingï¼‰ã€‚
- **A11y**ï¼šç‚ºå·¥å…·æç¤ºæä¾›æ–‡å­—æ›¿ä»£ï¼›ç¸®æ”¾æ“ä½œæ”¯æ´éµç›¤ã€‚

### 2.4 `SentimentTrendMiniChart`
- **ç”¨é€”**ï¼šæƒ…ç·’åˆ†æ•¸å°åœ–ï¼ˆæ™‚é–“åºåˆ—ï¼‰ã€‚
- **è³‡æ–™å¥‘ç´„**ï¼š`sentiment_series: SentimentSeriesItem[]`
- **äº’å‹•**ï¼šé»é¸æ™‚é–“é» â†’ é¡¯ç¤ºå°æ‡‰æ‘˜è¦ï¼›åˆ—è¡¨åŒæ­¥é«˜äº®ã€‚
- **ç©ºç‹€æ…‹**ï¼šé¡¯ç¤ºã€Œå°šç„¡è¿‘æœŸæƒ…ç·’è³‡æ–™ã€ã€‚

### 2.5 `NewsReferencesList`
- **ç”¨é€”**ï¼šå¼•ç”¨æ–°èåˆ—è¡¨ã€‚
- **æ¬„ä½**ï¼š`items: NewsReference[]`
- **é¡¯ç¤º**ï¼šä¾†æºã€æ™‚é–“ï¼ˆç›¸å°èˆ‡çµ•å°æ™‚é–“ï¼‰ã€æ¨™é¡Œï¼ˆå¯é»å¤–é€£ï¼‰ã€‚
- **å»é‡æç¤º**ï¼šè‹¥å¤šç¯‡è¿‘ä¼¼æ¨™é¡Œï¼Œé¡¯ç¤ºã€Œå·²åˆä½µ N ç¯‡ã€ã€‚

### 2.6 `RouterCostPanel`
- **ç”¨é€”**ï¼šAPIRouter æ±ºç­–èˆ‡æˆæœ¬é€æ˜åº¦ã€‚
- **æ¬„ä½**ï¼š`traces: RouterTrace[]`
- **è¦–åœ–**ï¼š
  - è¡¨æ ¼ï¼šä»»å‹™é¡å‹ã€ä¾›æ‡‰å•†ã€æ˜¯å¦ Failoverã€å»¶é²ã€tokensã€costã€‚
  - å°åœ–ï¼šä¾›æ‡‰å•†å æ¯”ã€Failover æ¬¡æ•¸ã€‚
- **å‘Šè­¦**ï¼šè‹¥æˆæœ¬/å»¶é²è¶…é–¾å€¼ï¼Œé¡¯ç¤ºè­¦ç¤ºå¾½ç« ã€‚

### 2.7 `MetaInfoBar`
- **ç”¨é€”**ï¼šé¡¯ç¤ºç‰ˆæœ¬ã€å»ºç«‹æ™‚é–“ã€è¿½æº¯ idsï¼ˆtrace idï¼‰ã€‚
- **äº’å‹•**ï¼šã€Œè¤‡è£½ trace idã€ã€ã€Œé–‹å•Ÿæ—¥èªŒæœå°‹ã€ã€‚

---

## 3) ç‰ˆé¢é…ç½®ï¼ˆLayoutï¼‰

- **æ¡Œæ©Ÿ**ï¼š
  - ä¸Šï¼š`StrategyHeader`ï¼ˆå…¨å¯¬ï¼‰
  - å·¦ï¼š`PriceWithIndicatorsChart`ï¼ˆ2/3ï¼‰
  - å³ï¼š`RouterCostPanel`ï¼ˆ1/3ï¼‰
  - ä¸‹ï¼š`ReasoningCard`ï¼ˆå…¨å¯¬ï¼‰
  - æœ€ä¸‹ï¼š`SentimentTrendMiniChart`ï¼ˆå·¦ 1/2ï¼‰ã€`NewsReferencesList`ï¼ˆå³ 1/2ï¼‰
- **è¡Œå‹•**ï¼šå‚ç›´å–®æ¬„é †åºåŒä¸Šï¼›åœ–è¡¨é è¨­ 7 æ—¥è¦–çª—ï¼Œæä¾›å¿«é€Ÿåˆ‡æ›ã€‚

---

## 4) äº’å‹•æµç¨‹ï¼ˆKey Interactionsï¼‰

1. ä½¿ç”¨è€…å¾ã€Œæœ€æ–°ç­–ç•¥ã€é»æ“ŠæŸåˆ— â†’ é–‹å•Ÿæœ¬é  â†’ é è¨­è¼‰å…¥æœ€è¿‘ 30 æ—¥åƒ¹æ ¼èˆ‡æŒ‡æ¨™ã€‚
2. æ»‘é¼ ç§»å‹•æ–¼åƒ¹åœ– â†’ åŒæ­¥é«˜äº® RSI/MACD è³‡æ–™é»ã€‚
3. åˆ‡æ›æ—¥æœŸè¦–çª—ï¼ˆ7/30/90 æ—¥ï¼‰â†’ é‡æ–°å–æ¨£/æ¸²æŸ“ã€‚
4. é»é¸æƒ…ç·’å°åœ–æŸé» â†’ åœ¨ `NewsReferencesList` é«˜äº®å°æ‡‰ä¾†æºã€‚
5. æª¢è¦– `RouterCostPanel` â†’ è‹¥çœ‹åˆ° Failoverï¼Œé»æ“Š badge é¡¯ç¤ºè©³ç´°éŒ¯èª¤è¨Šæ¯ï¼ˆæŠ½å–è‡ª logsï¼‰ã€‚
6. é»æ“Šã€ŒåŒ¯å‡ºã€â†’ ä¸‹è¼‰ Markdown å ±å‘Šï¼ˆå«åœ–è¡¨æˆªåœ–/é€£çµï¼‰ã€‚

---

## 5) ç‹€æ…‹ç®¡ç†ï¼ˆState Managementï¼‰

- **å…¨åŸŸ**ï¼š`selectedSymbol`, `selectedDate`, `timeRange`, `tzDisplay(Local/NY)`ã€‚
- **æ¨¡çµ„å…§éƒ¨**ï¼šå„è‡ª Loading/Error/Empty ç‹€æ…‹ã€‚
- **å¿«å–ç­–ç•¥**ï¼šåƒ¹æ ¼/æŠ€è¡“ 5 åˆ†é˜ã€æƒ…ç·’ 15 åˆ†é˜ã€Router æˆæœ¬ 15 åˆ†é˜ã€‚æ‰‹å‹•ã€Œé‡æ–°æ•´ç†ã€æŒ‰éˆ•æ¸…å¿«å–ã€‚

---

## 6) é©—æ”¶æ¨™æº–ï¼ˆAcceptance Criteriaï¼‰

- **åŠŸèƒ½**ï¼š
  - æ‰€æœ‰æ¬„ä½æ­£ç¢ºç¶å®š DB/æª”æ¡ˆä¾†æºï¼Œç„¡ç¼ºæ¼ã€‚
  - è² è¼‰ 1 è¬åƒ¹é»ä»¥å…§ï¼ŒP95 < 800msï¼›æ•´é ä¸»è¦–åœ–æ¸²æŸ“ < 3 ç§’ã€‚
  - åŒ¯å‡º Markdown å ±å‘ŠæˆåŠŸï¼Œå«ç­–ç•¥çµè«–ã€ä¸»è¦åœ–è¡¨é€£çµã€ä¾†æºæ¸…å–®ã€‚
- **å¯ç”¨æ€§/A11y**ï¼š
  - æŒ‡æ¨™å…·æ–‡å­—èªªæ˜ï¼Œé¡è‰²ä¸å–®ç¨æ‰¿è¼‰æ„ç¾©ã€‚
  - éµç›¤æ“ä½œå¯é”ä¸»è¦äº’å‹•ï¼ˆåˆ‡æ›å€é–“ã€å±•é–‹æ‘˜è¦ã€è·³è‡³éŒ¯èª¤ï¼‰ã€‚
- **è³‡æ–™ä¸€è‡´æ€§**ï¼š
  - æ™‚å€é¡¯ç¤ºä¸€è‡´ï¼ˆLocal/NY åˆ‡æ›æ¸…æ¥šæ¨™ç¤ºï¼‰ã€‚
  - æ•¸æ“šä¾†è‡ªåŒä¸€æ‰¹æ¬¡ï¼ˆæœ‰æ‰¹æ¬¡ id / trace idï¼‰ã€‚

---

## 7) é‚Šç•Œæƒ…æ³ï¼ˆEdge Casesï¼‰

- **è³‡æ–™ç¼ºæ¼**ï¼šç¼ºå°‘ RSI æˆ– MACD â†’ åœ–è¡¨é¡¯ç¤ºå ä½èˆ‡æç¤ºã€‚
- **æƒ…ç·’è³‡æ–™å»¶é²**ï¼šé¡¯ç¤ºæœ€æ–°å¯ç”¨æ™‚é–“èˆ‡ã€Œè³‡æ–™å»¶é² X åˆ†é˜ã€ã€‚
- **æ¥µç«¯å€¼**ï¼šRSI = 0/100ã€MACD æ¥µç«¯ï¼›æš«åœæ¨™è¨˜é¿å…åœ–è¡¨æ¯”ä¾‹å´©å£ã€‚
- **Failover**ï¼šé¡¯ç¤ºé™ç´šä¾›æ‡‰å•†èˆ‡éŒ¯èª¤æ‘˜è¦ï¼ˆä¸æš´éœ²æ•æ„Ÿæ†‘è­‰ï¼‰ã€‚

---

## 8) è¿½è¹¤èˆ‡åº¦é‡ï¼ˆTelemetryï¼‰

- äº‹ä»¶ï¼š`view_strategy_detail`, `change_time_range`, `export_md`, `hover_price_chart`, `open_router_cost`ã€‚
- æŒ‡æ¨™ï¼šäº’å‹•å»¶é²ã€æ¸²æŸ“æ™‚é–“ã€åŒ¯å‡ºæˆåŠŸç‡ã€éŒ¯èª¤ç‡ã€‚

---

## 9) æ¸¬è©¦æ¸…å–®ï¼ˆQA Checklistï¼Œç„¡ç¨‹å¼ç¢¼ï¼‰

- [ ] ä¸åŒè¦–çª—å¯¬åº¦ä¸‹æ’ç‰ˆç©©å®šï¼ˆâ‰¥320pxï¼‰ã€‚
- [ ] æš—/äº®è‰²å°æ¯”åº¦é” AAã€‚
- [ ] 7/30/90 æ—¥è³‡æ–™ä¸€è‡´ã€é‚Šç•Œåˆ‡æ›ç„¡éŒ¯ã€‚
- [ ] Router æˆæœ¬åˆè¨ˆ=å„ä»»å‹™åŠ ç¸½ï¼ŒFailover æ¨™è¨˜æ­£ç¢ºã€‚
- [ ] åŒ¯å‡º MD åŒ…å«å¿…è¦æ¬„ä½èˆ‡åœ–è¡¨é€£çµã€‚

---

> æœ¬è¦æ ¼æ›¸ç‰ˆæœ¬ï¼šv1ï¼ˆ2025-11-07ï¼‰ã€‚å°æ‡‰æ–‡ä»¶ï¼š`dashboard_ia.md`ã€`system_architecture.md`ã€`project_proposal.md`ã€`task_cards.md`ã€‚
